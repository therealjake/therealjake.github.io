"use strict";(self.webpackChunkshadowbear=self.webpackChunkshadowbear||[]).push([[599],{3599:(e,i,t)=>{t.r(i),t.d(i,{default:()=>g});var o,s,l,n,a,h,d=t(7580),r=(t(2916),Object.defineProperty),c=(e,i,t)=>(((e,i,t)=>{i in e?r(e,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[i]=t})(e,"symbol"!=typeof i?i+"":i,t),t),u=(e,i,t)=>{if(!i.has(e))throw TypeError("Cannot "+t)},p=(e,i,t)=>(u(e,i,"read from private field"),t?t.call(e):i.get(e)),v=(e,i,t)=>{if(i.has(e))throw TypeError("Cannot add the same private member more than once");i instanceof WeakSet?i.add(e):i.set(e,t)},m=(e,i,t,o)=>(u(e,i,"write to private field"),o?o.call(e,t):i.set(e,t),t),f=(e,i,t,o)=>({set _(o){m(e,i,o,t)},get _(){return p(e,i,o)}});class g{constructor(e){c(this,"config"),v(this,o,void 0),c(this,"initialized",!1),v(this,s,{}),v(this,l,0),v(this,n,0),v(this,a,[]),v(this,h,void 0),c(this,"noop",(()=>{})),this.onInitComplete=e.onInitComplete||this.noop,this.onThemeLoaded=e.onThemeLoaded||this.noop,this.onRollResult=e.onRollResult||this.noop,this.onRollComplete=e.onRollComplete||this.noop,this.onDieRemoved=e.onDieRemoved||this.noop,this.initialized=this.initScene(e)}async initScene(e){this.config=e.options,this.onInitComplete()}resize(){}loadTheme(){return Promise.resolve()}updateConfig(e){Object.assign(this.config,e)}addNonDie(e){console.log("die",e),clearTimeout(p(this,h));const{id:i,value:t,...o}=e,n={id:i,value:t,config:o};p(this,s)[i]=n,p(this,a).push(setTimeout((()=>{this.handleAsleep(n)}),f(this,l)._++*this.config.delay)),m(this,h,setTimeout((()=>{this.onRollComplete()}),500))}add(e){console.log("add die"),this.addNonDie(e)}remove(e){console.log("remove die");const i=p(this,s)[e.id];i.hasOwnProperty("d10Instance")&&(delete p(this,s)[i.d10Instance.id],f(this,n)._--),delete p(this,s)[e.id],f(this,n)._--,this.onDieRemoved(e.rollId)}clear(){!Object.keys(p(this,s)).length&&!p(this,n)||(p(this,a).forEach((e=>clearTimeout(e))),Object.values(p(this,s)).forEach((e=>{e.mesh&&e.mesh.dispose()})),m(this,s,{}),m(this,l,0),m(this,n,0))}async handleAsleep(e){var i,t;if(e.asleep=!0,await d.D.getRollResult(e),e.d10Instance||e.dieParent){if(null!=(i=null==e?void 0:e.d10Instance)&&i.asleep||null!=(t=null==e?void 0:e.dieParent)&&t.asleep){const i=100===e.config.sides?e:e.dieParent,t=10===e.config.sides?e:e.d10Instance;0===t.value&&0===i.value?i.value=100:i.value=i.value+t.value,this.onRollResult({rollId:i.config.rollId,value:i.value})}}else 10===e.config.sides&&0===e.value&&(e.value=10),this.onRollResult({rollId:e.config.rollId,value:e.value});f(this,n)._++}}o=new WeakMap,s=new WeakMap,l=new WeakMap,n=new WeakMap,a=new WeakMap,h=new WeakMap}}]);
//# sourceMappingURL=599.5af7fa54.chunk.js.map